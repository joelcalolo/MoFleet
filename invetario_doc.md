

A empresa opera uma frota de viaturas de diferentes marcas e modelos (Prado TXL, Land Cruiser V8, Mazda CX9, Pajero, Lexus, Jimny, Swift, i20/Accent, Fortuner, Dzire, entre outros) que necessitam de manuten√ß√£o regular e repara√ß√µes ocasionais.

---

## **2. SITUA√á√ÉO ACTUAL (PROBLEM√ÅTICA)**

### **2.1. Gest√£o de Stock Desorganizada**

Actualmente, a empresa possui um invent√°rio de pe√ßas e materiais para manuten√ß√£o e repara√ß√£o da frota, mas enfrenta os seguintes problemas:

#### **Problema 1: Falta de Estrutura de Dados**
- Tabela de invent√°rio **desorganizada e n√£o normalizada**
- Informa√ß√µes **incompletas** (muitos itens sem pre√ßo, sem fornecedor definido)
- **Aus√™ncia de c√≥digos √∫nicos** para identifica√ß√£o de pe√ßas
- **Dados duplicados** (mesma pe√ßa com descri√ß√µes diferentes)
- **Sem categoriza√ß√£o clara** dos materiais

#### **Problema 2: Impossibilidade de Rastreamento**
- **N√£o h√° registo de entradas** (quando foi comprado, de quem, por quanto, quem comprou)
- **N√£o h√° registo de sa√≠das** (quem usou, em que viatura, quando, para que tipo de manuten√ß√£o)
- **Imposs√≠vel saber o hist√≥rico** de consumo por viatura
- **Sem controlo de responsabilidades** (quem requisitou vs quem entregou)

#### **Problema 3: Aus√™ncia de Controlo Efectivo**
- **N√£o sabem quanto stock t√™m realmente** (sistema vs realidade f√≠sica)
- **Sem alertas de stock m√≠nimo** - descobrem que falta pe√ßa quando precisam
- **N√£o conseguem prever necessidades** de reposi√ß√£o
- **Perdas e desvios n√£o detectados**

#### **Problema 4: Falta de Informa√ß√£o para Gest√£o**
- **Imposs√≠vel calcular custos de manuten√ß√£o** por viatura
- **N√£o sabem quais pe√ßas s√£o mais consumidas**
- **Sem dados para negociar com fornecedores** (volume, frequ√™ncia)
- **Decis√µes tomadas "no escuro"** sem dados concretos

---

## **3. IMPACTOS NO NEG√ìCIO**

### **3.1. Impactos Operacionais**
- ‚è±Ô∏è **Tempo perdido** procurando pe√ßas ou descobrindo que n√£o h√° stock
- üöó **Viaturas paradas** por falta de pe√ßas que pensavam ter
- üîß **Manuten√ß√µes atrasadas** por falta de planeamento
- üì¶ **Compras urgentes** (mais caras) por falta de previs√£o

### **3.2. Impactos Financeiros**
- üí∞ **Compras duplicadas** - compram o que j√° t√™m mas n√£o sabem onde est√°
- üìâ **Stock morto** - pe√ßas paradas que poderiam estar a ser usadas
- üí∏ **Custos ocultos** - n√£o sabem quanto gastam realmente por viatura
- üî¥ **Perdas n√£o detectadas** - desvios, roubos, deteriora√ß√£o

### **3.3. Impactos de Gest√£o**
- üìä **Falta de dados** para an√°lise e tomada de decis√£o
- üéØ **Imposs√≠vel definir KPIs** de manuten√ß√£o
- üë• **Falta de accountability** - ningu√©m √© responsabilizado
- üìã **Auditorias dif√≠ceis** ou imposs√≠veis

### **3.4. Impactos no Cliente**
- üòû **Insatisfa√ß√£o** quando viatura n√£o est√° dispon√≠vel por estar em manuten√ß√£o
- ‚è∞ **Atrasos** nas entregas de viaturas
- üíî **Perda de confian√ßa** se problemas mec√¢nicos ocorrem frequentemente

---

## **4. NECESSIDADES IDENTIFICADAS**

A empresa precisa de um **sistema de controlo de invent√°rio** que permita:

### **4.1. Organiza√ß√£o B√°sica**
‚úÖ Catalogar todas as pe√ßas com c√≥digos √∫nicos  
‚úÖ Categorizar materiais de forma l√≥gica  
‚úÖ Manter informa√ß√µes completas (fornecedor, pre√ßo, especifica√ß√µes)  
‚úÖ Localizar pe√ßas facilmente no armaz√©m  

### **4.2. Controlo de Movimenta√ß√µes**
‚úÖ Registar **ENTRADAS**: quando compra, de quem, quanto custou, quem comprou  
‚úÖ Registar **SA√çDAS**: quem usou, em que viatura, quando, para que manuten√ß√£o  
‚úÖ Hist√≥rico completo e rastre√°vel de cada pe√ßa  
‚úÖ Saber stock actual em tempo real  

### **4.3. Gest√£o Proactiva**
‚úÖ Alertas de stock m√≠nimo  
‚úÖ Previs√£o de necessidades de reposi√ß√£o  
‚úÖ Identifica√ß√£o de pe√ßas cr√≠ticas  
‚úÖ Planeamento de compras  

### **4.4. An√°lise e Relat√≥rios**
‚úÖ Custo de manuten√ß√£o por viatura  
‚úÖ Consumo por tipo de pe√ßa  
‚úÖ Performance de fornecedores  
‚úÖ An√°lise de tend√™ncias  

### **4.5. Controlo e Responsabiliza√ß√£o**
‚úÖ Rastreamento de quem requisitou  
‚úÖ Aprova√ß√µes de sa√≠das (se necess√°rio)  
‚úÖ Controlo de acessos por tipo de utilizador  
‚úÖ Auditoria de todas as opera√ß√µes  

---

## **5. RESTRI√á√ïES E REQUISITOS**

### **5.1. Utilizadores do Sistema**
- **Gestores de Stock** - controlam entradas e sa√≠das
- **Compradores** - registam compras
- **Mec√¢nicos** - requisitam pe√ßas
- **Administrativos** - geram relat√≥rios
- **Gest√£o** - an√°lise e decis√µes estrat√©gicas

### **5.2. Requisitos T√©cnicos**
- Sistema deve ser **multi-utilizador**
- Acesso **simult√¢neo** sem conflitos
- **Interface simples** e intuitiva (nem todos s√£o t√©cnicos)
- Possibilidade de **acesso mobile** (mec√¢nicos no terreno)
- **Relat√≥rios export√°veis** (PDF, Excel)

### **5.3. Requisitos de Dados**
- **Integridade** - evitar duplica√ß√µes e inconsist√™ncias
- **Rastreabilidade** - auditoria completa
- **Backup** - seguran√ßa dos dados
- **Escalabilidade** - crescimento futuro

---

## **6. RESULTADO ESPERADO**

Com a implementa√ß√£o do sistema adequado, a empresa espera:

### **Curto Prazo (1-3 meses)**
‚úÖ Invent√°rio completo e organizado  
‚úÖ Controlo b√°sico de entradas e sa√≠das  
‚úÖ Redu√ß√£o de compras duplicadas  
‚úÖ Menos tempo perdido procurando pe√ßas  

### **M√©dio Prazo (3-6 meses)**
‚úÖ Redu√ß√£o de 30-40% em custos de manuten√ß√£o n√£o planeada  
‚úÖ Melhor negocia√ß√£o com fornecedores (dados de volume)  
‚úÖ Viaturas menos tempo paradas  
‚úÖ Planeamento de manuten√ß√µes mais eficiente  

### **Longo Prazo (6-12 meses)**
‚úÖ An√°lise preditiva de necessidades  
‚úÖ Optimiza√ß√£o de stock (nem excesso, nem falta)  
‚úÖ Decis√µes baseadas em dados concretos  
‚úÖ ROI mensur√°vel do sistema  

---

## **7. CRITICIDADE DO PROBLEMA**

**üî¥ ALTA PRIORIDADE**

Este problema afecta directamente:
- **Rentabilidade** da empresa
- **Qualidade do servi√ßo** ao cliente
- **Efici√™ncia operacional**
- **Competitividade** no mercado

A falta de controlo pode resultar em:
- Perdas financeiras significativas
- Perda de clientes
- Custos operacionais excessivos
- Impossibilidade de escalar o neg√≥cio

---

## **8. CONCLUS√ÉO**

A empresa possui os **materiais** mas n√£o possui o **sistema** para geri-los eficientemente. 

**A solu√ß√£o passa por:**
1. ‚úÖ Normalizar e estruturar os dados existentes
2. ‚úÖ Implementar sistema de controlo de invent√°rio
3. ‚úÖ Treinar equipa no uso do sistema
4. ‚úÖ Estabelecer processos de entrada/sa√≠da
5. ‚úÖ Monitorizar e ajustar continuamente

# üìä ESTRUTURA FINAL DA TABELA NORMALIZADA

## **MODELO DE DADOS COMPLETO - RENT A CAR INVENTORY SYSTEM**

---

## **TABELA 1: Fornecedores**

| Campo | Tipo | Restri√ß√µes | Descri√ß√£o |
|-------|------|------------|-----------|
| **ID_Fornecedor** | INT | PK, AUTO_INCREMENT | Identificador √∫nico |
| **Codigo_Fornecedor** | VARCHAR(20) | UNIQUE, NOT NULL | Ex: FORN001, FORN002 |
| **Nome_Fornecedor** | VARCHAR(100) | NOT NULL | GondonAfrica, Luanda da Sorte |
| **Nome_Contacto** | VARCHAR(100) | NULL | Nome da pessoa de contacto |
| **Telefone** | VARCHAR(20) | NULL | +244 923 456 789 |
| **Email** | VARCHAR(100) | NULL | contacto@fornecedor.ao |
| **Endereco** | TEXT | NULL | Morada completa |
| **NIF** | VARCHAR(30) | NULL | N√∫mero de Identifica√ß√£o Fiscal |
| **Observacoes** | TEXT | NULL | Notas adicionais |
| **Ativo** | BOOLEAN | DEFAULT TRUE | Fornecedor activo? |
| **Data_Cadastro** | DATETIME | DEFAULT NOW() | Quando foi cadastrado |
| **Criado_Por** | INT | FK ‚Üí Funcionarios | Quem cadastrou |

**√çndices:**
- PRIMARY KEY (ID_Fornecedor)
- UNIQUE INDEX (Codigo_Fornecedor)
- INDEX (Nome_Fornecedor)

---

## **TABELA 2: Categorias**

| Campo | Tipo | Restri√ß√µes | Descri√ß√£o |
|-------|------|------------|-----------|
| **ID_Categoria** | INT | PK, AUTO_INCREMENT | Identificador √∫nico |
| **Codigo_Categoria** | VARCHAR(10) | UNIQUE, NOT NULL | TRV, MOT, ELE, LUB, FIL |
| **Nome_Categoria** | VARCHAR(50) | NOT NULL | Trav√µes, Motor, El√©trico |
| **Descricao** | TEXT | NULL | Descri√ß√£o detalhada |
| **Cor_Identificacao** | VARCHAR(7) | NULL | C√≥digo hex para UI (#FF5733) |
| **Ordem_Exibicao** | INT | DEFAULT 0 | Ordem para listagens |
| **Ativo** | BOOLEAN | DEFAULT TRUE | Categoria activa? |

**√çndices:**
- PRIMARY KEY (ID_Categoria)
- UNIQUE INDEX (Codigo_Categoria)

---

## **TABELA 3: Pecas (Cat√°logo de Pe√ßas)**

| Campo | Tipo | Restri√ß√µes | Descri√ß√£o |
|-------|------|------------|-----------|
| **ID_Peca** | INT | PK, AUTO_INCREMENT | Identificador √∫nico |
| **Codigo_Peca** | VARCHAR(30) | UNIQUE, NOT NULL | TRV-PRADO-001 |
| **Nome_Peca** | VARCHAR(100) | NOT NULL | Cal√ßo de trav√£o frente |
| **Descricao_Completa** | TEXT | NULL | Descri√ß√£o detalhada |
| **ID_Categoria** | INT | FK ‚Üí Categorias, NOT NULL | Categoria da pe√ßa |
| **Referencia_Modelo** | VARCHAR(100) | NULL | Prado TXL, Mazda CX9 |
| **Codigo_Fabricante** | VARCHAR(50) | NULL | C√≥digo original do fabricante |
| **Unidade_Medida** | VARCHAR(10) | NOT NULL | un, L, kg, conj, rolo, jogo |
| **Stock_Minimo** | DECIMAL(10,2) | DEFAULT 0 | Alertar quando menor |
| **Stock_Maximo** | DECIMAL(10,2) | NULL | Stock ideal m√°ximo |
| **Ponto_Reposicao** | DECIMAL(10,2) | NULL | Quando pedir mais |
| **Localizacao_Armazem** | VARCHAR(50) | NULL | Prateleira A1, Sector B |
| **Preco_Medio** | DECIMAL(15,2) | DEFAULT 0 | Calculado automaticamente |
| **Imagem_URL** | VARCHAR(255) | NULL | Caminho para foto |
| **Codigo_Barras** | VARCHAR(50) | NULL | Para leitura por scanner |
| **Observacoes** | TEXT | NULL | Notas importantes |
| **Ativo** | BOOLEAN | DEFAULT TRUE | Pe√ßa activa no cat√°logo? |
| **Data_Cadastro** | DATETIME | DEFAULT NOW() | Quando foi cadastrada |
| **Criado_Por** | INT | FK ‚Üí Funcionarios | Quem cadastrou |
| **Ultima_Atualizacao** | DATETIME | ON UPDATE NOW() | √öltima modifica√ß√£o |

**√çndices:**
- PRIMARY KEY (ID_Peca)
- UNIQUE INDEX (Codigo_Peca)
- INDEX (ID_Categoria)
- INDEX (Nome_Peca)
- INDEX (Referencia_Modelo)
- INDEX (Codigo_Barras)

---

## **TABELA 4: Funcionarios**

| Campo | Tipo | Restri√ß√µes | Descri√ß√£o |
|-------|------|------------|-----------|
| **ID_Funcionario** | INT | PK, AUTO_INCREMENT | Identificador √∫nico |
| **Codigo_Funcionario** | VARCHAR(20) | UNIQUE, NOT NULL | FUNC001, FUNC002 |
| **Nome_Completo** | VARCHAR(100) | NOT NULL | Nome do funcion√°rio |
| **Cargo** | VARCHAR(50) | NULL | Mec√¢nico, Gestor Stock |
| **Departamento** | VARCHAR(50) | NULL | Manuten√ß√£o, Compras |
| **Telefone** | VARCHAR(20) | NULL | +244 923 456 789 |
| **Email** | VARCHAR(100) | NULL | funcionario@empresa.ao |
| **Username** | VARCHAR(50) | UNIQUE, NOT NULL | Para login no sistema |
| **Password_Hash** | VARCHAR(255) | NOT NULL | Senha encriptada |
| **Nivel_Permissao** | ENUM | NOT NULL | Admin, Gestor, Operador, Consulta |
| **Ativo** | BOOLEAN | DEFAULT TRUE | Funcion√°rio activo? |
| **Data_Admissao** | DATE | NULL | Data de entrada na empresa |
| **Data_Cadastro** | DATETIME | DEFAULT NOW() | Registo no sistema |

**Valores ENUM Nivel_Permissao:**
- 'ADMIN' - Acesso total
- 'GESTOR' - Gest√£o de stock
- 'COMPRADOR' - Registar compras
- 'MECANICO' - Requisitar pe√ßas
- 'CONSULTA' - Apenas visualiza√ß√£o

**√çndices:**
- PRIMARY KEY (ID_Funcionario)
- UNIQUE INDEX (Codigo_Funcionario)
- UNIQUE INDEX (Username)
- INDEX (Nome_Completo)

---

## **TABELA 5: Viaturas**

| Campo | Tipo | Restri√ß√µes | Descri√ß√£o |
|-------|------|------------|-----------|
| **ID_Viatura** | INT | PK, AUTO_INCREMENT | Identificador √∫nico |
| **Matricula** | VARCHAR(20) | UNIQUE, NOT NULL | LD-12-34-AB |
| **Marca** | VARCHAR(50) | NOT NULL | Toyota, Mazda, Suzuki |
| **Modelo** | VARCHAR(50) | NOT NULL | Prado TXL, CX9, Jimny |
| **Ano** | INT | NULL | 2020, 2021 |
| **Chassis** | VARCHAR(50) | UNIQUE, NULL | N√∫mero do chassis |
| **Cor** | VARCHAR(30) | NULL | Branco, Preto, Cinza |
| **Kilometragem_Atual** | DECIMAL(10,2) | DEFAULT 0 | Km actual |
| **Tipo_Combustivel** | VARCHAR(20) | NULL | Gasolina, Diesel |
| **Status** | ENUM | NOT NULL | Dispon√≠vel, Manuten√ß√£o, Alugado |
| **Observacoes** | TEXT | NULL | Notas sobre a viatura |
| **Ativo** | BOOLEAN | DEFAULT TRUE | Viatura activa na frota? |
| **Data_Cadastro** | DATETIME | DEFAULT NOW() | Registo no sistema |

**Valores ENUM Status:**
- 'DISPONIVEL'
- 'EM_MANUTENCAO'
- 'ALUGADO'
- 'INATIVO'

**√çndices:**
- PRIMARY KEY (ID_Viatura)
- UNIQUE INDEX (Matricula)
- UNIQUE INDEX (Chassis)
- INDEX (Marca, Modelo)

---

## **TABELA 6: Entradas (Compras)**

| Campo | Tipo | Restri√ß√µes | Descri√ß√£o |
|-------|------|------------|-----------|
| **ID_Entrada** | INT | PK, AUTO_INCREMENT | Identificador √∫nico |
| **Numero_Nota_Entrada** | VARCHAR(30) | UNIQUE, NOT NULL | ENT-2026-0001 |
| **Data_Entrada** | DATE | NOT NULL | Data da compra/recep√ß√£o |
| **Hora_Entrada** | TIME | DEFAULT NOW() | Hora do registo |
| **ID_Fornecedor** | INT | FK ‚Üí Fornecedores, NOT NULL | Quem vendeu |
| **ID_Peca** | INT | FK ‚Üí Pecas, NOT NULL | Qual pe√ßa |
| **Quantidade** | DECIMAL(10,2) | NOT NULL, CHECK > 0 | Quantidade comprada |
| **Preco_Unitario** | DECIMAL(15,2) | NOT NULL, CHECK >= 0 | Pre√ßo por unidade (Kz) |
| **Preco_Total** | DECIMAL(15,2) | GENERATED | Qtd √ó Pre√ßo Unit. |
| **Numero_Fatura** | VARCHAR(50) | NULL | N¬∫ da fatura do fornecedor |
| **Data_Fatura** | DATE | NULL | Data da fatura |
| **ID_Comprador** | INT | FK ‚Üí Funcionarios, NOT NULL | Quem comprou |
| **Documento_Anexo** | VARCHAR(255) | NULL | Caminho do PDF/foto |
| **Observacoes** | TEXT | NULL | Notas sobre a compra |
| **Status** | ENUM | DEFAULT 'CONFIRMADO' | Status da entrada |
| **Data_Registro** | DATETIME | DEFAULT NOW() | Quando foi registado |
| **Registrado_Por** | INT | FK ‚Üí Funcionarios | Quem registou no sistema |

**Valores ENUM Status:**
- 'PENDENTE' - Aguardando confirma√ß√£o
- 'CONFIRMADO' - Entrada confirmada
- 'CANCELADO' - Entrada cancelada

**√çndices:**
- PRIMARY KEY (ID_Entrada)
- UNIQUE INDEX (Numero_Nota_Entrada)
- INDEX (Data_Entrada)
- INDEX (ID_Fornecedor)
- INDEX (ID_Peca)
- INDEX (ID_Comprador)

**Trigger:** Ao inserir entrada confirmada ‚Üí actualizar stock

---

## **TABELA 7: Saidas (Utiliza√ß√µes/Requisi√ß√µes)**

| Campo | Tipo | Restri√ß√µes | Descri√ß√£o |
|-------|------|------------|-----------|
| **ID_Saida** | INT | PK, AUTO_INCREMENT | Identificador √∫nico |
| **Numero_Requisicao** | VARCHAR(30) | UNIQUE, NOT NULL | SAI-2026-0001 |
| **Data_Saida** | DATE | NOT NULL | Data da requisi√ß√£o |
| **Hora_Saida** | TIME | DEFAULT NOW() | Hora da sa√≠da |
| **ID_Peca** | INT | FK ‚Üí Pecas, NOT NULL | Qual pe√ßa |
| **Quantidade** | DECIMAL(10,2) | NOT NULL, CHECK > 0 | Quantidade retirada |
| **ID_Viatura** | INT | FK ‚Üí Viaturas, NULL | Para qual viatura (pode ser NULL) |
| **Kilometragem_Viatura** | DECIMAL(10,2) | NULL | Km no momento da manuten√ß√£o |
| **ID_Solicitante** | INT | FK ‚Üí Funcionarios, NOT NULL | Quem pediu/usou |
| **ID_Responsavel_Entrega** | INT | FK ‚Üí Funcionarios, NOT NULL | Quem entregou do stock |
| **Tipo_Saida** | ENUM | NOT NULL | Tipo de utiliza√ß√£o |
| **Motivo_Detalhado** | TEXT | NULL | Descri√ß√£o do problema/manuten√ß√£o |
| **Numero_Ordem_Servico** | VARCHAR(50) | NULL | N¬∫ da OS de manuten√ß√£o |
| **ID_Aprovador** | INT | FK ‚Üí Funcionarios, NULL | Quem aprovou (se necess√°rio) |
| **Data_Aprovacao** | DATETIME | NULL | Quando foi aprovado |
| **Status** | ENUM | DEFAULT 'PENDENTE' | Status da requisi√ß√£o |
| **Observacoes** | TEXT | NULL | Notas adicionais |
| **Data_Registro** | DATETIME | DEFAULT NOW() | Quando foi registado |

**Valores ENUM Tipo_Saida:**
- 'MANUTENCAO_PREVENTIVA'
- 'MANUTENCAO_CORRETIVA'
- 'REPARACAO_URGENTE'
- 'USO_INTERNO'
- 'TESTE'
- 'OUTROS'

**Valores ENUM Status:**
- 'PENDENTE' - Aguardando aprova√ß√£o
- 'APROVADO' - Aprovado mas n√£o entregue
- 'ENTREGUE' - Pe√ßa j√° entregue
- 'CANCELADO' - Requisi√ß√£o cancelada

**√çndices:**
- PRIMARY KEY (ID_Saida)
- UNIQUE INDEX (Numero_Requisicao)
- INDEX (Data_Saida)
- INDEX (ID_Peca)
- INDEX (ID_Viatura)
- INDEX (ID_Solicitante)
- INDEX (Status)

**Trigger:** Ao inserir sa√≠da entregue ‚Üí actualizar stock

---

## **TABELA 8: Movimentacoes (Hist√≥rico Completo)**

| Campo | Tipo | Restri√ß√µes | Descri√ß√£o |
|-------|------|------------|-----------|
| **ID_Movimentacao** | INT | PK, AUTO_INCREMENT | Identificador √∫nico |
| **Data_Hora** | DATETIME | DEFAULT NOW() | Timestamp da movimenta√ß√£o |
| **Tipo_Movimentacao** | ENUM | NOT NULL | Entrada, Sa√≠da, Ajuste, Devolu√ß√£o |
| **ID_Peca** | INT | FK ‚Üí Pecas, NOT NULL | Qual pe√ßa movimentou |
| **Quantidade** | DECIMAL(10,2) | NOT NULL | Qtd (+ ou -) |
| **ID_Referencia** | INT | NULL | ID da Entrada/Sa√≠da/Ajuste |
| **Tipo_Referencia** | VARCHAR(20) | NULL | 'ENTRADA', 'SAIDA', 'AJUSTE' |
| **Stock_Anterior** | DECIMAL(10,2) | NOT NULL | Stock antes da movimenta√ß√£o |
| **Stock_Novo** | DECIMAL(10,2) | NOT NULL | Stock ap√≥s movimenta√ß√£o |
| **ID_Usuario** | INT | FK ‚Üí Funcionarios, NOT NULL | Quem fez a opera√ß√£o |
| **Observacoes** | TEXT | NULL | Detalhes da movimenta√ß√£o |

**Valores ENUM Tipo_Movimentacao:**
- 'ENTRADA' - Compra de fornecedor
- 'SAIDA' - Utiliza√ß√£o/requisi√ß√£o
- 'AJUSTE' - Corre√ß√£o de invent√°rio
- 'DEVOLUCAO' - Retorno ao stock
- 'TRANSFERENCIA' - Entre locais

**√çndices:**
- PRIMARY KEY (ID_Movimentacao)
- INDEX (Data_Hora)
- INDEX (ID_Peca)
- INDEX (Tipo_Movimentacao)
- INDEX (ID_Referencia, Tipo_Referencia)

**IMPORTANTE:** Esta tabela √© **append-only** (apenas adiciona), nunca deleta registos.

---

## **TABELA 9: Ajustes_Inventario**

| Campo | Tipo | Restri√ß√µes | Descri√ß√£o |
|-------|------|------------|-----------|
| **ID_Ajuste** | INT | PK, AUTO_INCREMENT | Identificador √∫nico |
| **Numero_Ajuste** | VARCHAR(30) | UNIQUE, NOT NULL | AJU-2026-0001 |
| **Data_Ajuste** | DATE | NOT NULL | Data do ajuste |
| **Hora_Ajuste** | TIME | DEFAULT NOW() | Hora do ajuste |
| **ID_Peca** | INT | FK ‚Üí Pecas, NOT NULL | Qual pe√ßa |
| **Stock_Sistema** | DECIMAL(10,2) | NOT NULL | Stock no sistema antes |
| **Stock_Fisico** | DECIMAL(10,2) | NOT NULL | Stock contado fisicamente |
| **Diferenca** | DECIMAL(10,2) | GENERATED | Stock_Fisico - Stock_Sistema |
| **Motivo** | ENUM | NOT NULL | Raz√£o do ajuste |
| **Descricao_Motivo** | TEXT | NULL | Detalhes do motivo |
| **ID_Responsavel** | INT | FK ‚Üí Funcionarios, NOT NULL | Quem fez a contagem |
| **ID_Aprovador** | INT | FK ‚Üí Funcionarios, NULL | Quem aprovou o ajuste |
| **Data_Aprovacao** | DATETIME | NULL | Quando foi aprovado |
| **Status** | ENUM | DEFAULT 'PENDENTE' | Status do ajuste |
| **Documento_Anexo** | VARCHAR(255) | NULL | Foto/relat√≥rio |
| **Observacoes** | TEXT | NULL | Notas adicionais |
| **Data_Registro** | DATETIME | DEFAULT NOW() | Quando foi registado |

**Valores ENUM Motivo:**
- 'PERDA' - Pe√ßa perdida
- 'ROUBO' - Poss√≠vel roubo
- 'DANO' - Pe√ßa danificada
- 'ERRO_REGISTRO' - Erro de registo anterior
- 'CONTAGEM_FISICA' - Invent√°rio geral
- 'EXPIRACAO' - Pe√ßa expirada/vencida
- 'OUTROS'

**Valores ENUM Status:**
- 'PENDENTE' - Aguardando aprova√ß√£o
- 'APROVADO' - Ajuste aprovado e aplicado
- 'REJEITADO' - Ajuste rejeitado

**√çndices:**
- PRIMARY KEY (ID_Ajuste)
- UNIQUE INDEX (Numero_Ajuste)
- INDEX (Data_Ajuste)
- INDEX (ID_Peca)
- INDEX (Status)

**Trigger:** Ao aprovar ajuste ‚Üí actualizar stock e criar movimenta√ß√£o

---

## **TABELA 10: Stock_Atual (VIEW - Calculada)**

**ESTA √â UMA VIEW, N√ÉO UMA TABELA F√çSICA**

```sql
CREATE VIEW Stock_Atual AS
SELECT 
    p.ID_Peca,
    p.Codigo_Peca,
    p.Nome_Peca,
    p.Referencia_Modelo,
    c.Nome_Categoria,
    p.Unidade_Medida,
    p.Stock_Minimo,
    p.Stock_Maximo,
    p.Ponto_Reposicao,
    p.Localizacao_Armazem,
    
    -- Total de Entradas
    COALESCE(SUM(e.Quantidade), 0) AS Total_Entradas,
    
    -- Total de Sa√≠das
    COALESCE(SUM(s.Quantidade), 0) AS Total_Saidas,
    
    -- Stock Actual
    (COALESCE(SUM(e.Quantidade), 0) - COALESCE(SUM(s.Quantidade), 0)) AS Stock_Atual,
    
    -- Status do Stock
    CASE 
        WHEN (COALESCE(SUM(e.Quantidade), 0) - COALESCE(SUM(s.Quantidade), 0)) <= 0 
            THEN 'ESGOTADO'
        WHEN (COALESCE(SUM(e.Quantidade), 0) - COALESCE(SUM(s.Quantidade), 0)) < p.Stock_Minimo 
            THEN 'CRITICO'
        WHEN (COALESCE(SUM(e.Quantidade), 0) - COALESCE(SUM(s.Quantidade), 0)) <= p.Ponto_Reposicao 
            THEN 'BAIXO'
        WHEN p.Stock_Maximo IS NOT NULL 
            AND (COALESCE(SUM(e.Quantidade), 0) - COALESCE(SUM(s.Quantidade), 0)) > p.Stock_Maximo 
            THEN 'EXCESSO'
        ELSE 'OK'
    END AS Status_Stock,
    
    -- Pre√ßo M√©dio
    p.Preco_Medio,
    
    -- Valor Total em Stock
    (COALESCE(SUM(e.Quantidade), 0) - COALESCE(SUM(s.Quantidade), 0)) * p.Preco_Medio AS Valor_Total_Stock,
    
    -- √öltima Entrada
    MAX(e.Data_Entrada) AS Ultima_Entrada,
    
    -- √öltima Sa√≠da
    MAX(s.Data_Saida) AS Ultima_Saida
    
FROM Pecas p
LEFT JOIN Categorias c ON p.ID_Categoria = c.ID_Categoria
LEFT JOIN Entradas e ON p.ID_Peca = e.ID_Peca AND e.Status = 'CONFIRMADO'
LEFT JOIN Saidas s ON p.ID_Peca = s.ID_Peca AND s.Status = 'ENTREGUE'
WHERE p.Ativo = TRUE
GROUP BY p.ID_Peca
```

**Campos da VIEW:**
- ID_Peca
- Codigo_Peca
- Nome_Peca
- Referencia_Modelo
- Nome_Categoria
- Unidade_Medida
- Stock_Minimo
- Stock_Maximo
- Ponto_Reposicao
- Localizacao_Armazem
- Total_Entradas
- Total_Saidas
- Stock_Atual
- Status_Stock (ESGOTADO, CRITICO, BAIXO, OK, EXCESSO)
- Preco_Medio
- Valor_Total_Stock
- Ultima_Entrada
- Ultima_Saida

---

## **TABELA 11: Logs_Sistema (Auditoria)**

| Campo | Tipo | Restri√ß√µes | Descri√ß√£o |
|-------|------|------------|-----------|
| **ID_Log** | INT | PK, AUTO_INCREMENT | Identificador √∫nico |
| **Data_Hora** | DATETIME | DEFAULT NOW() | Timestamp da ac√ß√£o |
| **ID_Usuario** | INT | FK ‚Üí Funcionarios | Quem fez a ac√ß√£o |
| **Tabela_Afetada** | VARCHAR(50) | NOT NULL | Qual tabela foi alterada |
| **ID_Registro** | INT | NULL | ID do registo afectado |
| **Acao** | ENUM | NOT NULL | INSERT, UPDATE, DELETE |
| **Dados_Anteriores** | JSON | NULL | Dados antes da altera√ß√£o |
| **Dados_Novos** | JSON | NULL | Dados ap√≥s altera√ß√£o |
| **IP_Address** | VARCHAR(45) | NULL | IP do usu√°rio |
| **User_Agent** | VARCHAR(255) | NULL | Navegador/dispositivo |

**Valores ENUM Acao:**
- 'INSERT' - Cria√ß√£o de registo
- 'UPDATE' - Altera√ß√£o de registo
- 'DELETE' - Elimina√ß√£o de registo
- 'LOGIN' - Login no sistema
- 'LOGOUT' - Logout do sistema

**√çndices:**
- PRIMARY KEY (ID_Log)
- INDEX (Data_Hora)
- INDEX (ID_Usuario)
- INDEX (Tabela_Afetada)

---

## **üìä RELACIONAMENTOS (FOREIGN KEYS)**

```
Fornecedores (1) ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí (N) Entradas
Categorias (1) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí (N) Pecas
Pecas (1) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí (N) Entradas
Pecas (1) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí (N) Saidas
Pecas (1) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí (N) Movimentacoes
Pecas (1) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí (N) Ajustes_Inventario
Funcionarios (1) ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí (N) Entradas [comprador]
Funcionarios (1) ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí (N) Entradas [registrado_por]
Funcionarios (1) ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí (N) Saidas [solicitante]
Funcionarios (1) ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí (N) Saidas [responsavel_entrega]
Funcionarios (1) ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí (N) Saidas [aprovador]
Funcionarios (1) ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí (N) Movimentacoes [usuario]
Funcionarios (1) ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí (N) Ajustes_Inventario [responsavel]
Funcionarios (1) ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí (N) Ajustes_Inventario [aprovador]
Funcionarios (1) ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí (N) Logs_Sistema
Viaturas (1) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí (N) Saidas
```

---

## **üîß TRIGGERS NECESS√ÅRIOS**

### **Trigger 1: Actualizar Stock ap√≥s Entrada Confirmada**
```sql
CREATE TRIGGER atualizar_stock_entrada
AFTER INSERT ON Entradas
FOR EACH ROW
WHEN (NEW.Status = 'CONFIRMADO')
BEGIN
    INSERT INTO Movimentacoes (
        Tipo_Movimentacao,
        ID_Peca,
        Quantidade,
        ID_Referencia,
        Tipo_Referencia,
        Stock_Anterior,
        Stock_Novo,
        ID_Usuario
    ) VALUES (
        'ENTRADA',
        NEW.ID_Peca,
        NEW.Quantidade,
        NEW.ID_Entrada,
        'ENTRADA',
        (SELECT Stock_Atual FROM Stock_Atual WHERE ID_Peca = NEW.ID_Peca),
        (SELECT Stock_Atual FROM Stock_Atual WHERE ID_Peca = NEW.ID_Peca) + NEW.Quantidade,
        NEW.Registrado_Por
    );
END;
```

### **Trigger 2: Actualizar Stock ap√≥s Sa√≠da Entregue**
```sql
CREATE TRIGGER atualizar_stock_saida
AFTER UPDATE ON Saidas
FOR EACH ROW
WHEN (NEW.Status = 'ENTREGUE' AND OLD.Status != 'ENTREGUE')
BEGIN
    INSERT INTO Movimentacoes (
        Tipo_Movimentacao,
        ID_Peca,
        Quantidade,
        ID_Referencia,
        Tipo_Referencia,
        Stock_Anterior,
        Stock_Novo,
        ID_Usuario
    ) VALUES (
        'SAIDA',
        NEW.ID_Peca,
        -NEW.Quantidade,
        NEW.ID_Saida,
        'SAIDA',
        (SELECT Stock_Atual FROM Stock_Atual WHERE ID_Peca = NEW.ID_Peca),
        (SELECT Stock_Atual FROM Stock_Atual WHERE ID_Peca = NEW.ID_Peca) - NEW.Quantidade,
        NEW.ID_Responsavel_Entrega
    );
END;
```

### **Trigger 3: Actualizar Pre√ßo M√©dio ap√≥s Entrada**
```sql
CREATE TRIGGER atualizar_preco_medio
AFTER INSERT ON Entradas
FOR EACH ROW
WHEN (NEW.Status = 'CONFIRMADO')
BEGIN
    UPDATE Pecas
    SET Preco_Medio = (
        SELECT AVG(Preco_Unitario)
        FROM Entradas
        WHERE ID_Peca = NEW.ID_Peca
          AND Status = 'CONFIRMADO'
    )
    WHERE ID_Peca = NEW.ID_Peca;
END;
```

### **Trigger 4: Registar Ajuste de Invent√°rio**
```sql
CREATE TRIGGER aplicar_ajuste_inventario
AFTER UPDATE ON Ajustes_Inventario
FOR EACH ROW
WHEN (NEW.Status = 'APROVADO' AND OLD.Status = 'PENDENTE')
BEGIN
    INSERT INTO Movimentacoes (
        Tipo_Movimentacao,
        ID_Peca,
        Quantidade,
        ID_Referencia,
        Tipo_Referencia,
        Stock_Anterior,
        Stock_Novo,
        ID_Usuario
    ) VALUES (
        'AJUSTE',
        NEW.ID_Peca,
        NEW.Diferenca,
        NEW.ID_Ajuste,
        'AJUSTE',
        NEW.Stock_Sistema,
        NEW.Stock_Fisico,
        NEW.ID_Aprovador
    );
END;
```

---

## **üìà √çNDICES ADICIONAIS PARA PERFORMANCE**

```sql
-- √çndices compostos para queries frequentes
CREATE INDEX idx_entradas_peca_data ON Entradas(ID_Peca, Data_Entrada);
CREATE INDEX idx_saidas_peca_data ON Saidas(ID_Peca, Data_Saida);
CREATE INDEX idx_saidas_viatura_data ON Saidas(ID_Viatura, Data_Saida);
CREATE INDEX idx_movimentacoes_peca_data ON Movimentacoes(ID_Peca, Data_Hora);

-- √çndices para relat√≥rios
CREATE INDEX idx_entradas_fornecedor_data ON Entradas(ID_Fornecedor, Data_Entrada);
CREATE INDEX idx_saidas_solicitante ON Saidas(ID_Solicitante);
CREATE INDEX idx_saidas_tipo ON Saidas(Tipo_Saida);
```

---

## **üéØ CONSTRAINTS ADICIONAIS**

```sql
-- Garantir que quantidade em sa√≠das n√£o exceda stock
ALTER TABLE Saidas ADD CONSTRAINT check_stock_disponivel
CHECK (
    Quantidade <= (
        SELECT Stock_Atual 
        FROM Stock_Atual 
        WHERE ID_Peca = Saidas.ID_Peca
    )
);

-- Garantir que pre√ßos n√£o sejam negativos
ALTER TABLE Entradas ADD CONSTRAINT check_preco_positivo
CHECK (Preco_Unitario >= 0);

-- Garantir datas l√≥gicas
ALTER TABLE Saidas ADD CONSTRAINT check_data_aprovacao
CHECK (Data_Aprovacao IS NULL OR Data_Aprovacao >= Data_Saida);
```

---

## **‚úÖ RESUMO DA ESTRUTURA**

**11 Tabelas Principais:**
1. ‚úÖ Fornecedores (cadastro de fornecedores)
2. ‚úÖ Categorias (classifica√ß√£o de pe√ßas)
3. ‚úÖ Pecas (cat√°logo completo)
4. ‚úÖ Funcionarios (utilizadores do sistema)
5. ‚úÖ Viaturas (frota da empresa)
6. ‚úÖ Entradas (compras e recep√ß√µes)
7. ‚úÖ Saidas (requisi√ß√µes e utiliza√ß√µes)
8. ‚úÖ Movimentacoes (hist√≥rico completo)
9. ‚úÖ Ajustes_Inventario (corre√ß√µes de stock)
10. ‚úÖ Stock_Atual (VIEW calculada)
11. ‚úÖ Logs_Sistema (auditoria)

**Features Implementadas:**
- ‚úÖ Rastreabilidade completa (quem, quando, onde, porqu√™)
- ‚úÖ Controlo de aprova√ß√µes
- ‚úÖ Hist√≥rico imut√°vel
- ‚úÖ C√°lculo autom√°tico de stock
- ‚úÖ Alertas de stock m√≠nimo
- ‚úÖ Auditoria de todas opera√ß√µes
- ‚úÖ M√∫ltiplos n√≠veis de acesso
- ‚úÖ Integridade referencial

---

**Esta estrutura est√° completa e pronta para implementa√ß√£o!** 

Quer que eu:
1. Crie os scripts SQL completos?
2. Fa√ßa um diagrama ER (Entity-Relationship)?
3. Monte exemplos de dados para teste?